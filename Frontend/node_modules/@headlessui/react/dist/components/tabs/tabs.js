import M,{Fragment as Z,createContext as G,useContext as j,useMemo as L,useReducer as ee,useRef as H}from"react";import{render as v,Features as q,forwardRefWithAs as C}from'../../utils/render.js';import{useId as J}from'../../hooks/use-id.js';import{match as Q}from'../../utils/match.js';import{Keys as b}from'../../components/keyboard.js';import{focusIn as I,Focus as T,sortByDomNode as X}from'../../utils/focus-management.js';import{useIsoMorphicEffect as W}from'../../hooks/use-iso-morphic-effect.js';import{useSyncRefs as F}from'../../hooks/use-sync-refs.js';import{useResolveButtonType as te}from'../../hooks/use-resolve-button-type.js';import{useLatestValue as N}from'../../hooks/use-latest-value.js';import{FocusSentinel as re}from'../../internal/focus-sentinel.js';import{useEvent as U}from'../../hooks/use-event.js';import{microTask as ne}from'../../utils/micro-task.js';import{Hidden as ae}from'../../internal/hidden.js';var le=(n=>(n[n.SetSelectedIndex=0]="SetSelectedIndex",n[n.RegisterTab=1]="RegisterTab",n[n.UnregisterTab=2]="UnregisterTab",n[n.RegisterPanel=3]="RegisterPanel",n[n.UnregisterPanel=4]="UnregisterPanel",n))(le||{});let oe={[0](e,t){let r=e.tabs.filter(d=>{var l;return!((l=d.current)!=null&&l.hasAttribute("disabled"))});if(t.index<0)return{...e,selectedIndex:e.tabs.indexOf(r[0])};if(t.index>e.tabs.length)return{...e,selectedIndex:e.tabs.indexOf(r[r.length-1])};let o=e.tabs.slice(0,t.index),n=[...e.tabs.slice(t.index),...o].find(d=>r.includes(d));return n?{...e,selectedIndex:e.tabs.indexOf(n)}:e},[1](e,t){var n;if(e.tabs.includes(t.tab))return e;let r=e.tabs[e.selectedIndex],o=X([...e.tabs,t.tab],d=>d.current),c=(n=o.indexOf(r))!=null?n:e.selectedIndex;return c===-1&&(c=e.selectedIndex),{...e,tabs:o,selectedIndex:c}},[2](e,t){return{...e,tabs:e.tabs.filter(r=>r!==t.tab)}},[3](e,t){return e.panels.includes(t.panel)?e:{...e,panels:X([...e.panels,t.panel],r=>r.current)}},[4](e,t){return{...e,panels:e.panels.filter(r=>r!==t.panel)}}},B=G(null);B.displayName="TabsSSRContext";function K(e){let t=j(B);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,K),r}return t}let $=G(null);$.displayName="TabsDataContext";function _(e){let t=j($);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,_),r}return t}let z=G(null);z.displayName="TabsActionsContext";function V(e){let t=j(z);if(t===null){let r=new Error(`<${e} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,V),r}return t}function se(e,t){return Q(t.type,oe,e,t)}let ie=Z,ue=C(function(t,r){let{defaultIndex:o=0,vertical:c=!1,manual:n=!1,onChange:d,selectedIndex:l=null,...P}=t;const f=c?"vertical":"horizontal",y=n?"manual":"auto";let u=l!==null,x=F(r),[s,i]=ee(se,{selectedIndex:l!=null?l:o,tabs:[],panels:[]}),g=L(()=>({selectedIndex:s.selectedIndex}),[s.selectedIndex]),R=N(d||(()=>{})),E=N(s.tabs),m=L(()=>({orientation:f,activation:y,...s}),[f,y,s]),A=N(u?t.selectedIndex:s.selectedIndex),O=L(()=>({registerTab(p){return i({type:1,tab:p}),()=>i({type:2,tab:p})},registerPanel(p){return i({type:3,panel:p}),()=>i({type:4,panel:p})},change(p){A.current!==p&&R.current(p),u||i({type:0,index:p})}}),[i,u]);W(()=>{i({type:0,index:l!=null?l:o})},[l]);let w=H({tabs:[],panels:[]}),k={ref:x};return M.createElement(B.Provider,{value:w},M.createElement(z.Provider,{value:O},M.createElement($.Provider,{value:m},m.tabs.length<=0&&M.createElement(re,{onFocus:()=>{var p,h;for(let D of E.current)if(((p=D.current)==null?void 0:p.tabIndex)===0)return(h=D.current)==null||h.focus(),!0;return!1}}),v({ourProps:k,theirProps:P,slot:g,defaultTag:ie,name:"Tabs"}))))}),ce="div",de=C(function(t,r){let{orientation:o,selectedIndex:c}=_("Tab.List"),n=F(r);return v({ourProps:{ref:n,role:"tablist","aria-orientation":o},theirProps:t,slot:{selectedIndex:c},defaultTag:ce,name:"Tabs.List"})}),pe="button",fe=C(function(t,r){var h,D;let o=`headlessui-tabs-tab-${J()}`,{orientation:c,activation:n,selectedIndex:d,tabs:l,panels:P}=_("Tab"),f=V("Tab"),y=K("Tab"),u=H(null),x=F(u,r);W(()=>f.registerTab(u),[f,u]);let s=y.current.tabs.indexOf(o);s===-1&&(s=y.current.tabs.push(o)-1);let i=l.indexOf(u);i===-1&&(i=s);let g=i===d,R=U(a=>{let S=l.map(Y=>Y.current).filter(Boolean);if(a.key===b.Space||a.key===b.Enter){a.preventDefault(),a.stopPropagation(),f.change(i);return}switch(a.key){case b.Home:case b.PageUp:return a.preventDefault(),a.stopPropagation(),I(S,T.First);case b.End:case b.PageDown:return a.preventDefault(),a.stopPropagation(),I(S,T.Last)}if(Q(c,{vertical(){if(a.key===b.ArrowUp)return I(S,T.Previous|T.WrapAround);if(a.key===b.ArrowDown)return I(S,T.Next|T.WrapAround)},horizontal(){if(a.key===b.ArrowLeft)return I(S,T.Previous|T.WrapAround);if(a.key===b.ArrowRight)return I(S,T.Next|T.WrapAround)}}))return a.preventDefault()}),E=U(()=>{var a;(a=u.current)==null||a.focus()}),m=H(!1),A=U(()=>{var a;m.current||(m.current=!0,(a=u.current)==null||a.focus(),f.change(i),ne(()=>{m.current=!1}))}),O=U(a=>{a.preventDefault()}),w=L(()=>({selected:g}),[g]),k=t,p={ref:x,onKeyDown:R,onFocus:n==="manual"?E:A,onMouseDown:O,onClick:A,id:o,role:"tab",type:te(t,u),"aria-controls":(D=(h=P[i])==null?void 0:h.current)==null?void 0:D.id,"aria-selected":g,tabIndex:g?0:-1};return v({ourProps:p,theirProps:k,slot:w,defaultTag:pe,name:"Tabs.Tab"})}),be="div",Te=C(function(t,r){let{selectedIndex:o}=_("Tab.Panels"),c=F(r),n=L(()=>({selectedIndex:o}),[o]);return v({ourProps:{ref:c},theirProps:t,slot:n,defaultTag:be,name:"Tabs.Panels"})}),me="div",Pe=q.RenderStrategy|q.Static,xe=C(function(t,r){var E,m,A;let{selectedIndex:o,tabs:c,panels:n}=_("Tab.Panel"),d=V("Tab.Panel"),l=K("Tab.Panel"),P=`headlessui-tabs-panel-${J()}`,f=H(null),y=F(f,r);W(()=>d.registerPanel(f),[d,f]);let u=l.current.panels.indexOf(P);u===-1&&(u=l.current.panels.push(P)-1);let x=n.indexOf(f);x===-1&&(x=u);let s=x===o,i=L(()=>({selected:s}),[s]),g=t,R={ref:y,id:P,role:"tabpanel","aria-labelledby":(m=(E=c[x])==null?void 0:E.current)==null?void 0:m.id,tabIndex:s?0:-1};return!s&&((A=t.unmount)!=null?A:!0)?M.createElement(ae,{as:"span",...R}):v({ourProps:R,theirProps:g,slot:i,defaultTag:me,features:Pe,visible:s,name:"Tabs.Panel"})}),We=Object.assign(fe,{Group:ue,List:de,Panels:Te,Panel:xe});export{We as Tab};
